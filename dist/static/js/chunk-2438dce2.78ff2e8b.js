(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2438dce2"],{"62dd":function(t,e,o){"use strict";o("690f")},"690f":function(t,e,o){},b877:function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"container flex-c-c"},[!t.loading&&t.showForm?o("div",{staticClass:"form-area flex-col-c-c",class:!t.loading&&t.showForm?"float-up":""},[o("h1",{staticClass:"title underline"},[t._v("绑定手机")]),o("el-form",{ref:"form",attrs:{model:t.formData,rules:t.rules,"label-width":"0",size:"normal"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}}},[o("el-form-item",{attrs:{prop:"phone"}},[o("el-input",{attrs:{placeholder:"手机号","prefix-icon":"ri-smartphone-line"},on:{focus:t.focus,blur:t.blur},model:{value:t.formData.phone,callback:function(e){t.$set(t.formData,"phone",t._n(e))},expression:"formData.phone"}})],1),o("el-form-item",{staticClass:"verify-code",attrs:{prop:"smsCode"}},[o("el-input",{attrs:{placeholder:"验证码","prefix-icon":"ri-robot-line"},on:{focus:t.focus,blur:t.blur},model:{value:t.formData.smsCode,callback:function(e){t.$set(t.formData,"smsCode",e)},expression:"formData.smsCode"}}),o("el-button",{attrs:{type:"primary",size:"default",disabled:t.disabledGetCode},on:{click:t.getCode}},[t.getCodeLoading?o("i",{staticClass:"loading-icon ri-loader-4-line"}):o("span",[t._v(t._s(t.getCodeBtnText))])])],1),o("div",{staticClass:"i-el-form-item"},[o("div",{staticClass:"tips"},[t._v("绑定手机即代表您同意"),o("span",[t._v("XXX隐私政策")])])]),o("el-form-item",[o("el-button",{staticClass:"submit-btn",attrs:{disabled:t.submitLoading,type:"primary"},on:{click:t.submit}},[t.submitLoading?o("i",{staticClass:"loading-icon ri-loader-4-line"}):o("span",[t._v("绑定")])])],1)],1)],1):t._e()])},i=[],a=o("c24f"),n=o("83d6"),r=o.n(n),d={data:function(){return{loading:!1,token:"",state:"",showForm:!1,disabledGetCode:!1,getCodeBtnText:"获取验证码",getCodeLoading:!1,submitLoading:!1,formData:{phone:"",smsCode:""},rules:{phone:this.$formValidation.mobile,smsCode:this.$formValidation.required("验证码不能为空")}}},created:function(){var t=this.$dataDeepCopy(this.$route.query);if(!t.token||!t.state)return this.$router.push({path:"/login?type=wechat"}),!1;this.token=t.token,this.state=t.state,this.checkBind(this.token),this.$nextTick((function(){this.$router.push({query:{}}),console.log(this.token),console.log(this.state)}))},methods:{checkBind:function(t){var e=this;this.loading=!0,this.$axios.get(this.$config.BASE_URL+"/user/updatePassword",{headers:{Authorization:t}}).then((function(o){var s=o.data;console.log(s),401===s.code&&e.$router.push({path:"/login?type=wechat"}),500===s.code&&(e.showForm=!0,document.title="绑定手机 - "+r.a.title,e.loading=!1),200==s.code&&e.$store.dispatch("user/saveInfo",t)})).catch((function(t){e.$msg("error","微信登录失败，请稍后重试"),e.$router.push({path:"/login?type=wechat"})}))},getCode:function(){var t=this;this.$refs.form.validateField("phone",(function(e){e||(t.getCodeLoading=!0,t.disabledGetCode=!0,Object(a["d"])(t.formData.phone).then((function(e){t.getCodeLoading=!1,t.$msg("success","短信验证码已发送到您的手机，请注意查收");var o=60;t.getCodeBtnText=o+"S";var s=setInterval((function(){o>1?(o--,t.getCodeBtnText=o+"S"):(s&&clearInterval(s),t.getCodeBtnText="获取验证码",t.disabledGetCode=!1)}),1e3)})).catch((function(e){t.getCodeLoading=!1,t.disabledGetCode=!1,t.$msg("error","短信验证码获取失败，请稍后重试")})))}))},submit:function(){var t=this;this.$refs.form.validate((function(e){e&&(t.submitLoading=!0,t.$store.commit("user/SET_TOKEN",t.token),Object(a["f"])(t.formData).then((function(e){var o=e.data;console.log(e),t.$msg("success","绑定成功"),t.submitLoading=!1,t.$store.dispatch("user/saveInfo",o)})).catch((function(e){console.error(e),t.$store.commit("user/RESET_STATE"),t.$msg("error","绑定失败"),t.submitLoading=!1})))}))},focus:function(t){t.target.parentNode.classList.add("focus")},blur:function(t){t.target.parentNode.classList.remove("focus")}}},c=d,l=(o("62dd"),o("2877")),u=Object(l["a"])(c,s,i,!1,null,"1b53aacc",null);e["default"]=u.exports}}]);